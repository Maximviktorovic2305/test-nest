# Система бронирования событий - Сводка проекта

## Обзор проекта
Это масштабируемая backend-система для бронирования событий, разработанная с использованием современных практик Node.js и архитектуры Feature-Sliced Design (FSD) для обеспечения удобства сопровождения и масштабируемости.

## Реализованные функции

### 1. Аутентификация и авторизация
- Система аутентификации на основе JWT
- Управление доступом на основе ролей (пользователь/администратор)
- Конечные точки регистрации и входа
- Шифрование паролей с помощью bcrypt

### 2. Управление событиями
- Операции CRUD для событий
- Валидация данных с помощью DTO
- Разрешения только для администратора для создания/обновления/удаления

### 3. Система бронирования
- Отслеживание доступности мест
- Автоматическое обновление счетчика мест
- Функциональность отмены бронирования
- Авторизация пользователя для бронирований

### 4. Безопасность и валидация
- Валидация входных данных с использованием class-validator
- Ограничение частоты запросов для предотвращения злоупотреблений
- Глобальная обработка исключений
- Включенный CORS

### 5. Документация и мониторинг
- Документация API Swagger по адресу `/api`
- Конечная точка проверки состояния по адресу `/health`
- Асинхронное логирование с помощью Winston в файл и консоль

### 6. Инфраструктура
- Конфигурация Docker Compose для MySQL и Redis
- Prisma ORM для операций с базой данных
- Конфигурация на основе окружения

## Стек технологий
- **Фреймворк**: NestJS v11 + TypeScript
- **База данных**: MySQL с Prisma ORM
- **Аутентификация**: JWT через `@nestjs/jwt` и Passport
- **Валидация**: `class-validator` + `class-transformer`
- **Логирование**: Winston
- **Ограничение частоты запросов**: `@nestjs/throttler`
- **Документация API**: Swagger/OpenAPI через `@nestjs/swagger`
- **Тестирование**: Jest + Supertest

## Конечные точки API

### Аутентификация
- `POST /auth/register` - Регистрация пользователя
- `POST /auth/login` - Вход пользователя

### События
- `POST /events` - Создание события (только для администратора)
- `GET /events` - Список всех событий
- `GET /events/:id` - Получение деталей события
- `PATCH /events/:id` - Обновление события (только для администратора)
- `DELETE /events/:id` - Удаление события (только для администратора)

### Бронирования
- `POST /bookings` - Создание бронирования
- `GET /bookings` - Список бронирований пользователя (или всех для администратора)
- `GET /bookings/:id` - Получение деталей бронирования
- `DELETE /bookings/:id` - Отмена бронирования

### Система
- `GET /` - Приветственное сообщение
- `GET /health` - Проверка состояния
- `GET /api` - Документация Swagger

## Структура проекта
```
src/
├── app/              # Конфигурация приложения и корневой модуль
├── features/         # Основные бизнес-функции
│   ├── auth/         # Логика аутентификации
│   ├── events/       # Управление событиями
│   └── bookings/     # Логика бронирования
├── shared/           # Повторно используемые утилиты
│   ├── config/       # Конфигурация окружения
│   ├── database/     # Сервис базы данных Prisma
│   ├── exceptions/   # Глобальная обработка исключений
│   ├── logger/       # Логирование с помощью Winston
│   └── validation/   # Утилиты валидации
└── main.ts           # Точка входа
```

## Инструкции по настройке

1. Установите зависимости:
   ```bash
   npm install
   ```

2. Запустите базу данных и Redis:
   ```bash
   docker-compose up -d
   ```

3. Сгенерируйте клиент Prisma:
   ```bash
   npm run prisma:generate
   ```

4. Запустите миграции базы данных:
   ```bash
   npm run prisma:migrate
   ```

5. Запустите сервер разработки:
   ```bash
   npm run start:dev
   ```

6. Доступ к документации API:
   Откройте `http://localhost:3000/api` в вашем браузере

## Тестирование

- Модульные тесты: `npm run test`
- Режим наблюдения: `npm run test:watch`
- Покрытие: `npm run test:cov`
- E2E тесты: `npm run test:e2e`

## Функции масштабируемости

Система разработана для обработки высоких нагрузок:
- Безсостоятельные экземпляры Node.js для горизонтального масштабирования
- Пул соединений для эффективности базы данных
- Кэширование Redis для часто запрашиваемых данных
- Ограничение частоты запросов для предотвращения злоупотреблений
- Асинхронное логирование для избежания блокирующих операций

## Будущие улучшения

1. Реализовать кэширование Redis для данных событий
2. Добавить email-уведомления для бронирований
3. Реализовать рабочие очереди с BullMQ
4. Добавить более полное тестовое покрытие
5. Реализовать индексацию базы данных для лучшей производительности
6. Добавить мониторинг с Prometheus и Grafana

## Заключение

Эта система бронирования событий предоставляет прочную основу для масштабируемой платформы бронирования. Она следует лучшим практикам безопасности, удобства сопровождения и производительности. Модульная архитектура делает ее легкой для расширения дополнительными функциями по мере необходимости.